/*! @name videojs-extra-buttons @version 0.1.5 @license MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsExtraButtons=e(t.videojs)}(this,function(t){"use strict";function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var a={},r=(t=t&&t.hasOwnProperty("default")?t.default:t).registerPlugin||t.plugin,n=t.getComponent("Button"),i=t.getComponent("MenuButton"),o=t.getComponent("MenuItem"),l=function(t){function a(e,a){var r;return(r=t.call(this,e,{title:"快退",name:"QuickBackwardButton"})||this).player=e,r.step=a||10,r}return e(a,t),a.prototype.handleClick=function(){var t=this.player.currentTime()-this.step;this.player.currentTime(t>0?t:0)},a}(n),c=function(t){function a(e,a){var r;return(r=t.call(this,e,{title:"快进",name:"QuickForwardButton"})||this).player=e,r.step=a||10,r}return e(a,t),a.prototype.handleClick=function(){var t=this.player.currentTime(),e=this.player.duration(),a=t+this.step;this.player.currentTime(a<e?a:e)},a}(n),s=function(t){function a(e,a,r,n,i){var o;return(o=t.call(this,e,{label:r,selectable:!0,selected:n})||this).player=e,o.menuButton=a,o.label=r,o.qualitiId=i.id,o.bitrate=i.bitrate,o}return e(a,t),a.prototype.handleClick=function(){var t=this.player;this.menuButton.unselectAll(),this.selected(!0),this.menuButton.$(".vjs-icon-placeholder").innerText=this.label;var e=t.qualityLevels().levels_||[],a=Array.isArray(e),r=0;for(e=a?e:e[Symbol.iterator]();;){var n;if(a){if(r>=e.length)break;n=e[r++]}else{if((r=e.next()).done)break;n=r.value}var i=n;i.enabled=i.id===this.qualitiId||"AUTO"===this.qualitiId}this.menuButton.unpressButton()},a}(o);function u(t,e){var a=e;return a||(a=window.location.origin+window.location.pathname),new URL(t,a)}var h=function(t){function a(e,a,r){var n,i=r+"X",o=e.playbackRate()==r;return(n=t.call(this,e,{label:i,selectable:!0,selected:o})||this).player=e,n.menuButton=a,n.rate=r,n.label=i,n}return e(a,t),a.prototype.handleClick=function(){this.menuButton.unselectAll(),this.selected(!0),this.menuButton.$(".vjs-icon-placeholder").innerText=this.label,this.player.playbackRate(this.rate)},a}(o);var d=function(){function t(t,e){this.player=t,this.opts={},this.opts.qualitySelect=e.qualitySelect,this.opts.playbackRateSelect=e.playbackRateSelect||[],this.opts.quickBackward=e.quickBackward||!1,this.opts.quickForward=e.quickForward||!1,this.createQuickBackwardButton_(),this.createQuickForwardButton_(),this.createQualitySelectButton_(),this.createPlaybackRateSelectButton_(),this.onSrcChange_()}var a=t.prototype;return a.setOption=function(t,e){switch(this.opts[t]=e,t){case"qualitySelect":this.createQualitySelectButton_();break;case"playbackRateSelect":this.createPlaybackRateSelectButton_();break;case"quickBackward":this.createQuickBackwardButton_();break;case"quickForward":this.createQuickForwardButton_();break;default:console.error("do not support option ["+t+"]")}},a.onSrcChange_=function(){var t=this;this.player.on("loadstart",function(e){t.createQualitySelectButton_()})},a.createQuickBackwardButton_=function(){var t=this.player;if(this.quickBackwardButton&&(this.quickBackwardButton.dispose(),t.controlBar.removeChild(this.quickBackwardButton),this.quickBackwardButton=null),this.opts.quickBackward){this.quickBackwardButton=new l(t,this.opts.quickBackward.seconds);var e=t.controlBar.getChild("PlayToggle"),a=t.controlBar.children().indexOf(e),r=t.controlBar.addChild(this.quickBackwardButton,{componentClass:"QuickBackwardButton"},a);r.removeClass("vjs-hidden"),r.addClass("vjs-quick-backward")}},a.createQuickForwardButton_=function(){var t=this.player;if(this.quickForwardButton&&(this.quickForwardButton.dispose(),t.controlBar.removeChild(this.quickForwardButton),this.quickForwardButton=null),this.opts.quickForward){this.quickForwardButton=new c(t,this.opts.quickForward.seconds);var e=t.controlBar.getChild("PlayToggle"),a=t.controlBar.children().indexOf(e)+1,r=t.controlBar.addChild(this.quickForwardButton,{componentClass:"QuickForwardButton"},a);r.removeClass("vjs-hidden"),r.addClass("vjs-quick-forward")}},a.createQualitySelectButton_=function(){var t=this.player;if(this.qualitySelectButton&&(this.qualitySelectButton.dispose(),t.controlBar.removeChild(this.qualitySelectButton),this.qualitySelectButton=null),this.opts&&this.opts.qualitySelect&&t.qualityLevels&&t.tech({IWillNotUseThisInPlugins:!0}).hls&&(this.qualitySelectButton=function(t,a){var r=new(function(a){function r(){return a.call(this,t,{title:"",name:"QualitySelectMenuButton"})||this}e(r,a);var n=r.prototype;return n.unselectAll=function(){},n.createItems=function(){return[]},r}(i));r.$(".vjs-icon-placeholder").innerText="AUTO";var n=u(t.currentSrc()).href;return t.qualityLevels().on("addqualitylevel",function(){var e=t.qualityLevels().levels_||[];if(!(e.length<=1)){var i=[];i.push(new s(t,r,"AUTO",!0,{id:"AUTO"}));var o=e,l=Array.isArray(o),c=0;for(o=l?o:o[Symbol.iterator]();;){var h;if(l){if(c>=o.length)break;h=o[c++]}else{if((c=o.next()).done)break;h=c.value}var d=h,p=u(d.id,n),y=p.searchParams.get("__name");if(Array.isArray(a)&&a.length>0){a.sort(function(t,e){return!t.bandwidth&&e.bandwidth?-1:t.bandwidth&&!e.bandwidth?1:t.bandwidth||e.bandwidth?t.bandwidth-e.bandwidth:-1});var B=a,f=Array.isArray(B),k=0;for(B=f?B:B[Symbol.iterator]();;){var v;if(f){if(k>=B.length)break;v=B[k++]}else{if((k=B.next()).done)break;v=k.value}var b=v;if(d.bitrate&&b.bandwidth&&d.bitrate<=b.bandwidth){y=b.name;break}}y||(y=a[a.length-1].name)}if(!y)if(d.height)y=d.height+"P";else if(d.bitrate){var w=d.bitrate/1024;if(w<1)y=d.bitrate+"bit";else{var m=w/1024;y=m>1?Math.round(m)+"Mb":Math.round(w)+"Kb"}}else y=p.pathname.substring(p.pathname.lastIndexOf("/")+1);y=decodeURIComponent(y),i.push(new s(t,r,y,!1,d))}i.sort(function(t,e){return t.bitrate||e.bitrate?t.bitrate&&!e.bitrate?1:!t.bitrate&&e.bitrate?-1:e.bitrate-t.bitrate:1}),r.createItems=function(){return i},r.unselectAll=function(){for(var t=0;t<i.length;t++){var e=i[t];e&&e.selected(!1)}},r.update()}}),r}(t,this.opts.qualitySelect),this.qualitySelectButton)){var a=t.controlBar.getChild("FullscreenToggle"),r=t.controlBar.children().indexOf(a);-1==r&&(r=t.controlBar.children().length);var n=t.controlBar.addChild(this.qualitySelectButton,{componentClass:"QualitySelectMenuButton"},r);n.removeClass("vjs-hidden"),n.addClass("vjs-quality-select")}},a.createPlaybackRateSelectButton_=function(){var t=this.player;if(this.playbackRateSelectButton&&(this.playbackRateSelectButton.dispose(),t.controlBar.removeChild(this.playbackRateSelectButton),this.playbackRateSelectButton=null),this.opts.playbackRateSelect&&0!=this.opts.playbackRateSelect.length){this.playbackRateSelectButton=function(t,a){var r=[],n=new(function(n){function i(){return n.call(this,t,{title:"",name:"PlaybackRateSelectMenuButton"})||this}e(i,n);var o=i.prototype;return o.unselectAll=function(){for(var t=0;t<r.length;t++)r[t].selected(!1)},o.createItems=function(){r.length&&r.splice(0,r.length);var e=a,n=Array.isArray(e),i=0;for(e=n?e:e[Symbol.iterator]();;){var o;if(n){if(i>=e.length)break;o=e[i++]}else{if((i=e.next()).done)break;o=i.value}var l=o;r.push(new h(t,this,l))}return r},i}(i));return n.$(".vjs-icon-placeholder").innerText=t.playbackRate()+"X",n}(t,this.opts.playbackRateSelect);var a=t.controlBar.getChild("FullscreenToggle"),r=t.controlBar.children().indexOf(a);-1==r&&(r=t.controlBar.children().length);var n=t.controlBar.addChild(this.playbackRateSelectButton,{componentClass:"PlaybackRateSelectButton"},r);n.removeClass("vjs-hidden"),n.addClass("vjs-quality-select")}},t}(),p=function(e){var r=this;this.ready(function(){!function(t,e){t.addClass("vjs-extra-buttons"),t.extraButtons=new d(t,e)}(r,t.mergeOptions(a,e))})};return r("extraButtons",p),p.VERSION="0.1.5",p});
